#Title
declare title=$(cat << EOS
MincraftServer Deploy Tool

     .S_SSSs    S.       .S_SSSs     sdSSSSSSSbs   .S    sSSs
    .SS~SSSSS   SS.     .SS~SSSSS    YSSSSSSSS%S  .SS   d%%SP
    S%S   SSSS  S%S     S%S   SSSS          S%S   S%S  d%S'
    S%S    S%S  S%S     S%S    S%S         S&S    S%S  S%S
    S%S SSSS%S  S&S     S%S SSSS%S        S&S     S&S  S&S
    S&S  SSS%S  S&S     S&S  SSS%S        S&S     S&S  S&S_Ss
    S&S    S&S  S&S     S&S    S&S       S&S      S&S  S&S~SP
    S&S    S&S  S&S     S&S    S&S      S*S       S&S  S&S
    S*S    S&S  S*b     S*S    S&S     S*S        S*S  S*b
    S*S    S*S  S*S.    S*S    S*S   .s*S         S*S  S*S
    S*S    S*S   SSSbs  S*S    S*S   sY*SSSSSSSP  S*S  S*S
    SSS    S*S    YSSP  SSS    S*S  sY*SSSSSSSSP  S*S  S*S
           SP                  SP                 SP   SP
           Y                   Y                  Y    Y

                                                      for bash
                 Installation preparation start
                        C-c to cancel


EOS
)

#ResetScreen
alreset(){
	clear
	echo "$title"
}

#EndScript
alend(){
cat << EOS
Initial setting is completed,
please read readme.txt for operation method.

EOS
read -p "Enter to exit."
clear
}

#Config file
confgen(){
local conf=$(cat << EOS
#
# conf - here document string
#
CONF=`pwd`
JRE='`which java`'
ARG='-Xms2G -Xmx4G'
PORT_MIN=50000
PORT_MAX=60000
WAIT=30

#END OF FILE
EOS
)
echo "${conf}" > core/conf
}

#start up
start_up(){
	local -a APT_LIST
	local -r LIB="lib"
	local -r SLIB="slib"
	local -r CONF="conf"
	local org

	org=`pwd`
	echo "*First boot setting*"
	echo "${!LIB}" > $LIB
	source ./$LIB
	home=$(dir_dialog)
	mkdir $home/conf $home/core
	mv ./$LIB $home/core
	mv ./pip $home/core
	mv ./pipb $home/core
	mv ./piph $home/core
	mv ./pipf $home/core
	echo "${!SLIB}" > $home/core/$SLIB

	cd $home
	source ./core/$LIB
	source ./core/$SLIB
	confgen
	echo "$confconf" > confconf.sh
	echo "$mcmake" > mcmake.sh
	echo "$run" > run.sh
	chmod a+x confconf.sh
	chmod a+x mcmake.sh
	chmod a+x run.sh
	touch core/log

	alreset
	read -p "Do an availability check.Press Enter."
	APT_LIST+=(`apt_install_dialog -w jre-headless -t JRE`)
	alreset
	APT_LIST+=(`apt_install_dialog -w ^screen/ -t screen`)
	alreset
	APT_LIST+=(`apt_install_dialog -w ^ufw/ -t ufw`)
	alreset
	apt_list_installer APT_LIST

	alreset
	read -ep "Would you like to create the environment now?[Y/n] : " yn
	case $yn in
	[Yy])
		alreset
		bash confconf.sh -n ${home##*/}
		alreset
		bash mcmake.sh ${home##*/} create -- --
	esac

	alreset
	alend
	echo "$readme" > readme.txt
	cd $org
	rm alazif

}
